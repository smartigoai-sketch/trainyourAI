<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Smartigo PRO â€” Success</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{margin:0;background:#0b0b0f;color:#eaeaf2;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
    .wrap{max-width:640px;margin:0 auto;padding:40px 16px;}
    .card{background:#121218;border:1px solid #1d1d26;padding:24px;text-align:center}
    a.btn{display:inline-block;margin-top:14px;padding:10px 16px;text-decoration:none;
      background:linear-gradient(135deg,#5dcdf0,#8d7cfb);color:#0b0b0f;font-weight:700}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Payment received âœ…</h1>
      <p>Activating your Smartigo PROâ€¦</p>
      <p id="msg" style="color:#a8a8b3"></p>
      <a class="btn" href="https://smartigoai.eu">Back to Smartigo</a>
    </div>
  </div>

<script>
const APPS_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbwGOZPX8cFOElL1MpHH5YD_SRpD6Jl2zSkoigB8RxQOC1LulqMSZty5A_-yJ4-fvKOKTA/exec";

function getEmail() {
  const qs = new URLSearchParams(location.search);
  const fromSession = qs.get("session_id");

  // ðŸ”¥ DEBUG FONDAMENTALE
  console.log("DEBUG session_id =", fromSession);

  if (fromSession) {
    return "SESSION:" + fromSession;
  }

  try {
    return localStorage.getItem("smartigo_email") || "";
  } catch(e){
    return "";
  }
}

function activatePro(){
  const msg = document.getElementById("msg");
  const emailOrSession = getEmail();

  if (!emailOrSession) {
    msg.textContent = "Missing email/session. Please contact support.";
    return;
  }

  let url;
  if (emailOrSession.startsWith("SESSION:")) {
    const sid = emailOrSession.replace("SESSION:", "");
    url = APPS_SCRIPT_URL + "?action=pro_from_session&session_id=" + encodeURIComponent(sid);
  } else {
    url = APPS_SCRIPT_URL + "?action=prosignup&email=" + encodeURIComponent(emailOrSession);
  }

  const iframe = document.createElement("iframe");
  iframe.style.display = "none";
  iframe.src = url;
  document.body.appendChild(iframe);

  msg.textContent = "PRO is active! Your Day 6 email will arrive within a few seconds.";
}

activatePro();
</script>

</body>
</html>
